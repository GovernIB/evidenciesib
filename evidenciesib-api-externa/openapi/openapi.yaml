openapi: 3.0.1
info:
  title: API REST EXTERNA de EvidenciesIB
  description: Conjunt de Serveis REST de EvidenciesIB per ser accedits des de l'exterior
  contact:
    name: Departament de Govern Digital a la Fundació Bit
    url: http://governdigital.fundaciobit.org
    email: governdigital@fundaciobit.org
  license:
    name: License Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0
  version: 1.0.0
externalDocs:
  description: Java Client (GovernIB Github)
  url: https://github.com/GovernIB/evidenciesib/tree/evidenciesib-1.0/evidenciesib-api-externa-client
servers:
- url: /evidenciesibapi/externa
- url: http://localhost:8080/evidenciesibapi/externa
- url: https://dev.caib.es/evidenciesibapi/externa
- url: https://proves.caib.es/evidenciesibapi/externa
- url: https://se.caib.es/evidenciesibapi/externa
- url: https://www.caib.es/evidenciesibapi/externa
tags:
- name: Evidencies
  description: Realització d'Evidències via API REST
paths:
  /secure/evidencies/get/{evidenciaID}:
    get:
      tags:
      - Evidencies
      summary: Retorna informació d'una evidència a partir del seu id
      operationId: get
      parameters:
      - name: evidenciaID
        in: path
        description: Identificador de l'evidència de la que volem informació
        required: true
        schema:
          type: integer
          format: int64
      - name: language
        in: query
        description: Idioma en que s'han de retornar les dades i errors(Només suportat
          'ca' o 'es')
        schema:
          type: string
        examples:
          Català:
            description: Català
            value: ca
          Castellano:
            description: Castellano
            value: es
        example: ca
      responses:
        "400":
          description: Paràmetres incorrectes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "401":
          description: No Autenticat
          content:
            application/json:
              schema:
                type: string
        "403":
          description: No Autoritzat
          content:
            application/json:
              schema:
                type: string
        "500":
          description: Error no controlat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "200":
          description: Retornada correctament la informació de l'evidència
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvidenciaWs'
      security:
      - BasicAuth: []
  /secure/evidencies/getfile/{evidenciaID}/{encryptedFileID}:
    get:
      tags:
      - Evidencies
      summary: Retorna informació d'un fitxer d'una evidència a partir del encryptedFileID
      operationId: getfile
      parameters:
      - name: evidenciaID
        in: path
        description: Identificador de l'evidència de la que volem informació
        required: true
        schema:
          type: integer
          format: int64
      - name: encryptedFileID
        in: path
        description: Identificador encriptat del fitxer que volem descarregar.
        required: true
        schema:
          type: string
      - name: language
        in: query
        description: Idioma en que s'han de retornar les dades i errors(Només suportat
          'ca' o 'es')
        schema:
          type: string
        examples:
          Català:
            description: Català
            value: ca
          Castellano:
            description: Castellano
            value: es
        example: ca
      responses:
        "400":
          description: Paràmetres incorrectes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "401":
          description: No Autenticat
          content:
            application/json:
              schema:
                type: string
        "403":
          description: No Autoritzat
          content:
            application/json:
              schema:
                type: string
        "500":
          description: Error no controlat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "200":
          description: Retornada correctament la informació de l'evidència
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvidenciaFile'
      security:
      - BasicAuth: []
  /secure/evidencies/getfilebase64/{evidenciaID}/{encryptedFileID}:
    get:
      tags:
      - Evidencies
      summary: Retorna informació d'un fitxer d'una evidència a partir del encryptedFileID
      operationId: getfilebase64
      parameters:
      - name: evidenciaID
        in: path
        description: Identificador de l'evidència de la que volem informació
        required: true
        schema:
          type: integer
          format: int64
      - name: encryptedFileID
        in: path
        description: Identificador encriptat del fitxer que volem descarregar.
        required: true
        schema:
          type: string
      - name: language
        in: query
        description: Idioma en que s'han de retornar les dades i errors(Només suportat
          'ca' o 'es')
        schema:
          type: string
        examples:
          Català:
            description: Català
            value: ca
          Castellano:
            description: Castellano
            value: es
        example: ca
      responses:
        "400":
          description: Paràmetres incorrectes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "401":
          description: No Autenticat
          content:
            application/json:
              schema:
                type: string
        "403":
          description: No Autoritzat
          content:
            application/json:
              schema:
                type: string
        "500":
          description: Error no controlat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "200":
          description: Retornada correctament la informació de l'evidència
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvidenciaFileBase64'
      security:
      - BasicAuth: []
  /secure/evidencies/list:
    get:
      tags:
      - Evidencies
      summary: 'Retorna un llistat de les evidencies '
      operationId: list
      parameters:
      - name: inici
        in: query
        description: "Data d'inici, en format yyyy-MM-dd (ISO 8601), a partir de la\
          \ qual volem obtenir dades"
        schema:
          type: string
        example: 2022-08-29
      - name: fi
        in: query
        description: "Data fi, en format yyyy-MM-dd (ISO 8601), fins la qual volem\
          \ tenir dades"
        schema:
          type: string
        example: 2023-12-31
      - name: page
        in: query
        description: Pàgina de la que es volen obtenir les dades
        schema:
          type: integer
          format: int32
        example: 1
      - name: pagesize
        in: query
        description: Quantitat d'elements a retornar
        schema:
          type: integer
          format: int32
        example: 10
      - name: language
        in: query
        description: Idioma en que s'han de retornar les dades(Només suportat 'ca'
          o 'es')
        schema:
          type: string
        examples:
          Català:
            description: Català
            value: ca
          Castellano:
            description: Castellano
            value: es
        example: ca
      responses:
        "400":
          description: "EFIB: Paràmetres incorrectes"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "401":
          description: "EFIB: No Autenticat"
          content:
            application/json:
              schema:
                type: string
        "403":
          description: "EFIB: No Autoritzat"
          content:
            application/json:
              schema:
                type: string
        "500":
          description: "EFIB: Error durant la consulta de les dades obertes"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "200":
          description: "EFIB: Retornades dades obertes correctament"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvidenciaWsPaginacio'
      security:
      - BasicAuth: []
  /secure/evidencies/start:
    post:
      tags:
      - Evidencies
      summary: Primera cridada a realitzar per iniciar un procés d'evidències
      operationId: start
      requestBody:
        description: Estructura de dades inicials per iniciar un procés d'evidències
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EvidenciaStartRequest'
      responses:
        "400":
          description: Paràmetres incorrectes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "401":
          description: No Autenticat
          content:
            application/json:
              schema:
                type: string
        "403":
          description: No Autoritzat
          content:
            application/json:
              schema:
                type: string
        "500":
          description: Error no controlat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "200":
          description: Procés de recolecció d'evidències inciaciat correctament
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EvidenciaStartResponse'
      security:
      - BasicAuth: []
  /secure/evidencies/versio:
    get:
      tags:
      - Evidencies
      summary: Retorna la versió d'aquest Servei
      operationId: versio
      responses:
        "401":
          description: No Autenticat
          content:
            application/json:
              schema:
                type: string
        "510":
          description: Només s'utilitza per crear fitxer de constants...
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConstantsWs'
        "403":
          description: No Autoritzat
          content:
            application/json:
              schema:
                type: string
        "500":
          description: Error no controlat
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestExceptionInfo'
        "200":
          description: Retornada correctament la versió d'aquest Servei
          content:
            application/json:
              schema:
                type: string
      security:
      - BasicAuth: []
components:
  schemas:
    RestExceptionInfo:
      required:
      - code
      - errorMessage
      type: object
      properties:
        code:
          type: integer
          description: Codi de HTTP de l'error. Veure https://en.wikipedia.org/wiki/List_of_HTTP_status_codes.
          format: int32
        errorMessage:
          type: string
          description: Missatge de l'error
        stackTrace:
          type: string
          description: Stacktrace de l'excepció si n'hi hagués.
        causeException:
          type: string
          description: Tipus de l'excepció origen (cause) si n'hi hagués.
        causeStackTrace:
          type: string
          description: Stacktrace de l'excepció origen (cause) si n'hi hagués.
      description: Estructura de dades utilitzada per passar informació d'un error
    EvidenciaFile:
      type: object
      properties:
        name:
          type: string
          description: Nom del fitxer
        mime:
          type: string
          description: Tipus MIME del Fitxer
        size:
          type: integer
          description: Mida en bytes del document
          format: int64
        description:
          type: string
          description: Descripció del Fitxer
        encryptedFileID:
          type: string
          description: Identificar del fitxer per poder-ho recuperar en una segona
            fase. Només apareix en llistats per no incloure el contingut del fitxer.
        document:
          type: string
          description: Contingut del fitxer. En llistats aquest camp vendrà buit.
          format: byte
      description: Objecte per enviar i rebre fitxers així com la informació associada
        a aquest.
    EvidenciaWs:
      required:
      - dataInici
      - firmaIdiomaDocument
      - firmaReason
      - firmaTipusDocumental
      - firmaTipusDocumentalDescripcio
      - fitxerOriginal
      - loginData
      - loginId
      - loginQaa
      - loginSubtype
      - loginType
      - loginTypeDescription
      - personaLlinatge1
      - personaLlinatge2
      - personaNif
      - personaNom
      type: object
      properties:
        evidenciaID:
          type: integer
          description: Identificador únic de l'evidència.
          format: int64
        nom:
          type: string
          description: Nom descriptiu de l'evidència.
        personaNom:
          type: string
          description: Nom de la persona
        personaLlinatge1:
          type: string
          description: Primer llinatge de la persona
        personaLlinatge2:
          type: string
          description: Segon llintge de la persona
        personaNif:
          type: string
          description: Nif de la persona
        personaEmail:
          type: string
          description: Email de la persona
        personaMobil:
          type: string
          description: Mòbil de la persona
        dataInici:
          pattern: yyyy-MM-dd'T'HH:mm:ss
          type: string
          description: Data de creació de l'evidència
          format: date-time
        dataFi:
          pattern: yyyy-MM-dd'T'HH:mm:ss
          type: string
          description: Data final de l'evidència
          format: date-time
        estatCodi:
          type: integer
          description: "Estat en que ha finalitzat l'evidència. Posibles estats:\r\
            \n    public static final int EVIDENCIA_ESTAT_CODI_ERROR = -1;\r\n   \
            \ public static final int EVIDENCIA_ESTAT_CODI_EN_PROCES_DE_CREACIO =\
            \ 1;\r\n    public static final int EVIDENCIA_ESTAT_CODI_EN_PROCES_DE_LOGIN\
            \ = 2;\r\n    public static final int EVIDENCIA_ESTAT_CODI_EN_PROCES_DE_FIRMA\
            \ = 3;\r\n    public static final int EVIDENCIA_ESTAT_CODI_SIGNAT = 10;"
          format: int32
        estatCodiDescripcio:
          type: string
          description: Descripció del camp estatCodi
        estatError:
          type: string
          description: Missatge de l'error
        estatExcepcio:
          type: string
          description: Stacktrace de l'excepció si n'hi hagues
        loginType:
          type: integer
          description: Codi del Tipus de Login
          format: int32
        loginTypeDescription:
          type: string
          description: Descripció del tipus de login
        loginSubtype:
          type: string
          description: Subtipus de login
        loginQaa:
          type: string
          description: Nivell des eguretat de login
        loginData:
          pattern: yyyy-MM-dd'T'HH:mm:ss
          type: string
          description: Data de realització del login
          format: date-time
        loginId:
          type: string
          description: Identificador del login realitzat.
        loginAuthMethod:
          type: string
        loginAdditionalProperties:
          type: string
        localitzacioIp:
          type: string
          description: IP des d'on està connectat el ciutadà
        localitzacioCodiPostal:
          type: string
          description: Codi postal des d'on està connectat el ciutadà.
        localitzacioLatitud:
          type: string
          description: Latitud des d'on està connectat el ciutadà.
        localitzacioLongitud:
          type: string
          description: Longitud des d'on està connectat el ciutadà.
        localitzacioCiutat:
          type: string
          description: Localitat des d'on està connectat el ciutadà.
        localitzacioRegio:
          type: string
          description: Regió (Si és Espanya Comunitat Autonoma) des d'on està connectat
            el ciutadà.
        localitzacioPais:
          type: string
          description: Pais des d'on està connectat el ciutadà.
        firmaReason:
          type: string
          description: Raó de firma.
        firmaIdiomaDocument:
          type: string
          description: Idioma en que està escrit el document.
        firmaTipusDocumental:
          type: integer
          description: Tipus documental de la Firma. Veure https://administracionelectronica.gob.es/pae_Home/dam/jcr:26d90313-7af0-4f69-9d62-c853d55d7627/Esquema_Metadatos_e-EMGDE_2016.pdf
          format: int32
        firmaTipusDocumentalDescripcio:
          type: string
          description: DescripcioTipus documental de la Firma.Per exemple per 1 retorna
            'Resolución(TD01)'
          example: "1"
        fitxerOriginal:
          $ref: '#/components/schemas/EvidenciaFile'
        fitxerAdaptat:
          $ref: '#/components/schemas/EvidenciaFile'
        fitxerSignat:
          $ref: '#/components/schemas/EvidenciaFile'
      description: Estructura que inclou tota la informació de l'evidència.
    EvidenciaFileBase64:
      type: object
      properties:
        name:
          type: string
          description: Nom del fitxer
        mime:
          type: string
          description: Tipus MIME del Fitxer
        size:
          type: integer
          description: Mida en bytes del document
          format: int64
        description:
          type: string
          description: Descripció del Fitxer
        encryptedFileID:
          type: string
          description: Identificar del fitxer per poder-ho recuperar en una segona
            fase. Només apareix en llistats per no incloure el contingut del fitxer.
        documentBase64:
          type: string
          description: Contingut del fitxer en Base64. En llistats aquest camp vendrà
            buit.
      description: |-
        Objecte per enviar i rebre fitxers així com la informació associada a aquest.
        No utilitza byte[] que falla dins del JBoss7 sinó que utilitza un String per enviar el fitxer en Base64
    EvidenciaWsPaginacio:
      required:
      - data
      - page
      - pagesize
      - totalcount
      - totalpages
      type: object
      properties:
        pagesize:
          type: integer
          description: Mida de pàgina
          format: int32
        page:
          type: integer
          description: Número pàgina. Comença per 1.
          format: int32
        totalpages:
          type: integer
          description: Número total de pàgines
          format: int32
        totalcount:
          type: integer
          description: Numero total d'elements
          format: int32
        data:
          type: array
          description: Elements retornats
          items:
            $ref: '#/components/schemas/EvidenciaWs'
    EvidenciaStartRequest:
      required:
      - callBackUrl
      - documentASignar
      - languageDocument
      - languageUI
      - personaNif
      - raoDeLaFirma
      - titolEvidencia
      type: object
      properties:
        titolEvidencia:
          type: string
          description: Titol descriptiu de l'evidència que es durà a terme
        personaNif:
          type: string
          description: Nif de la persona
        personaUsername:
          type: string
          description: Username de la persona
        personaNom:
          type: string
          description: Nom de la persona
        personaLlinatge1:
          type: string
          description: Primer llinatge de la persona
        personaLlinatge2:
          type: string
          description: Segon llintge de la persona
        personaEmail:
          type: string
          description: Correu electrònic de la persona
        personaMobil:
          type: string
          description: Mòbil de la persona
        raoDeLaFirma:
          type: string
          description: Raó per la qual es requereix aquesta signatura
        languageDocument:
          type: string
          description: Idioma del document en ISO 639-1. Valors permesos 'ca' i 'es'
          example: ca
          default: ca
        documentASignar:
          $ref: '#/components/schemas/EvidenciaFile'
        callBackUrl:
          type: string
          description: "URL de retorn quan el proces d'evidències hagi acabat. A la\
            \ URL la cadena {0} es substituirà per l'identificador de l'evidència\
            \ (evidenciaID)"
          example: "http://host:port/myappback/mycallbackcontroller/callbackevidencies?evidenciaid={0}"
        languageUI:
          type: string
          description: Idioma del missatges d'error en format ISO 639-1. Valors permesos
            'ca' i 'es'
          example: ca
          default: ca
      description: Estructura de dades a enviar al servidor per iniciar un procés
        d'Evidències
    EvidenciaStartResponse:
      required:
      - evidenciaID
      - evidenciaUrlRedirect
      type: object
      properties:
        evidenciaID:
          type: integer
          description: Identificador del nou procés de recolecció d'evidències
          format: int64
        evidenciaUrlRedirect:
          type: string
          description: Adreça a on redirigir el navegador del client per iniciar la
            recolecció d'evidències
          format: uri
    ConstantsWs:
      required:
      - EVIDENCIA_ESTAT_CODI_EN_PROCES_DE_CREACIO
      - EVIDENCIA_ESTAT_CODI_EN_PROCES_DE_FIRMA
      - EVIDENCIA_ESTAT_CODI_EN_PROCES_DE_LOGIN
      - EVIDENCIA_ESTAT_CODI_ERROR
      - EVIDENCIA_ESTAT_CODI_SIGNAT
      type: object
      properties:
        EVIDENCIA_ESTAT_CODI_ERROR:
          type: integer
          description: Codi d'estat d'una evidència que indica un error
          format: int32
          readOnly: true
          default: -1
        EVIDENCIA_ESTAT_CODI_EN_PROCES_DE_CREACIO:
          type: integer
          description: Codi d'estat d'una evidència que indica que esta en procés
            de creació
          format: int32
          readOnly: true
          default: 1
        EVIDENCIA_ESTAT_CODI_EN_PROCES_DE_LOGIN:
          type: integer
          description: Codi d'estat d'una evidència que indica que esta realitzant
            el login
          format: int32
          readOnly: true
          default: 2
        EVIDENCIA_ESTAT_CODI_EN_PROCES_DE_FIRMA:
          type: integer
          description: Codi d'estat d'una evidència que indica que esta realitzant
            la firma del document
          format: int32
          readOnly: true
          default: 3
        EVIDENCIA_ESTAT_CODI_SIGNAT:
          type: integer
          description: Codi d'estat d'una evidència que indica que ha finalitzat correctament
          format: int32
          readOnly: true
          default: 10
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
